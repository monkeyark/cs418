# Trapezoidal Maps and Point Queries

## Prerequisite


Programming Project: Trapezoidal Maps and Point Queries
In this programming project, you are asked to implement the randomized algorithm for incremental construction of a trapezoidal map and its associated point query algorithm as described in Chapter 6. The input will be a planar subdivision represented as a doubly connected edge list (DCEL). Your code first permuates the edges randomly and then adds them according to the order in the permutation. You may use the procedure for random permutation on page 77.
The generated trapezoid map T is not explicitly represented. Its structure can be recovered from the trapezoid records. Every trapezoid t stores four pointers/references describing its geometry:

top for the top bounding edge (from the input DCEL);
bottom for the bottom bounding edge (also from the input DCEL);
leftp defining the trapezoid's left vertical edge (possibly degenerating to the point leftp); and
rightp defining its right vertical edge (possibly degenerating to the point rightp).
The search structure D is represented by a directed acyclic graph (DAG). The trapezoids and the leaves in D should cross reference each other.
Convention on Naming
You are allowed to use any programming language in the implementation. The output "name" of a geometric or graph entity (e.g., a vertex, an edge, etc.) should follow the convention below. In the case, say, an object-oriented programming language such as Java is used, this name refers to the printed name of the object of some class representing the geometric entity as generated by the class' toString() method, not the name of a referrence variable for the same object.
The left, right, top, and bottom sides of the bounding box R for the planar subdivision are named L, R, T, and B, respectively.
The four vertices of R, starting at the upper left corner, are named counterclockwise as c1, c2, c3, and c4.
A trapezoid, whether degenerating into a triangle or not, has its name starting with t and ending with a unique number, for example, t10.
Every vertex in the input planar division (and the non-explicitly represented trapezoidal map) has its name starting with v and ending with a unique number, for instance, v4.
A half-edge, say, from the vertex v4 to the vertex v5, should be named e4,5; hence its twin half-edge is named e5,4.
In the search structure D (a DAG), it is suggested that you create three subclasses of the Node class: one for x-nodes, one for y-nodes, and one for leaves. An x-node is named after the corresponding vertex; a y-node is named after the corresponding edge; and a leaf is named after the corresponding trapezoid. It is possible that multiple nodes in D have the same (printed) name.
Doubly Connected Edge List
Recall from the textbook (pp. 29-33) that a DCEL includes three types of records. Consider a planar subdivision induced by three segments that happen to be the sides of a triangle with vertices v1 = (0, 0), v2 = (1, 0), and v3 = (0, 1). Let f1 be the face bounded by the triangle and f2 be the unbounded face. The following is a valid DCEL representation of this subdivision.
v1 (0, 0) e1,2
v2 (1, 0) e2,3
v3 (0, 1) e3,1

f1 e2,3 nil
f2 nil e1,3

e1,2 v1 e2,1 f1 e2,3 e3,1
e2,1 v2 e1,2 f2 e1,3 e3,2
e1,3 v1 e3,1 f2 e3,2 e2,1
e3,1 v3 e1,3 f1 e1,2 e2,3
e2,3 v2 e3,2 f1 e3,1 e1,2
e3,2 v3 e2,3 f2 e2,1 e1,3

Always leave two blank spaces between adjacent names on each line, and one blank line between records of different types. If a face has multiple holes, then its record should list a sequence of half-edges separated by semicolons, one from the boundary of each hole. For example, the following is a record of some unbounded face f1:

f1 nil e9,10;e1,2;e13,11

The face has three inner components, i.e, the planar subdivision has three connected components (at the outmost level as they may contain holes themselves). These components respectively have half-edges e9,10, e1,2, and e13,11 on their boundaries.

Input
In practice, point location usually takes place on a map. Therefore, an input file stores a DCEL representing some planar subdivision, which at the moment is not enclosed in a bounding box.
Trapezoidal Map Construction and Query
You are asked to implement the randomized incremental algorithm described in Section 6.2 for constructing the trapezoidal map and its associated search structure from an input file. Your code should handle the following two degeneracies (see Section 6.3 of the textbook):
Two or more endpoints (possbily on the same edge) have the same x-coordinate.
A query point is on the vertical line of an x-node.
Your code should be able to perform a query with a point and output the trapezoid containing the point as specified next.
Output
Your code will read from a file name.txt (name being a string of digits, English letters, and dash) and output in the file trapezoidalMap.txt as below. Every trapezoid is output as a sequence that starts with two segments top and bottom and end with two vertices leftp and rightp.
The four objects top, bottom, leftp, and rightp are output on separate lines.
leftp and rightp are output as their names in the DCEL, for example, v1 and v2.
top and bottom are each output as the name of the corresponding half-edge that bounds the trapezoid.
If the trapezoid is bounded on the left (the right, respectively) by a vertical edge from the input planar subdivision, let leftp (rightp, respectively) denote the lower endpoint of that edge.
The left, right, top, and bottom edges of the bounding box are written as the letters "L", "R", "T", and "B", respectively.
Below is a sample output for the (degenerate) trapezoid representing the triangle given earlier with vertices v1, v2, and v3.

e2,3
e1,2
v1
v2

In outputing a trapezoidal map, list all trapezoids contained inside one face from the input planar subdivision before moving on to another face. No particular order is assumed among the faces, or among the trapezoids inside the same face. You have the freedom to choose an order for traversing the faces, as well as an order for traversing the trapezoids inside the same face. Output the name of a face, followed by a listing of its contained trapezoids, then the name of the next face, and so on. Below is a sample output of the trapezoidal map constructed over the earlier DCEL example defined by a single triangle:


****** Trapezoidal Map******

Face f1 contains 1 trapezoid:

e2,3
e1,2
v1
v2


Face f2 contains 4 trapezoids:

T
B
L
v1

T
e3,2
v3
v2

T
B
v2
R

e2,1
B
v1
v2


A query point may coincide with a vertex. It may also lie in the interior of an input edge, a later created vertical edge, or a trapezoid.

If the query point is a vertex in the input planar subdivision, just output the vertex name, e.g., v2.
If the point is not a vertex but lies on an edge in the planar subdivsion, just output one of the two corresponding half-edges, e.g., e1,3.
If the point lies on a created vertical edge of the trapezoidal map, output either of the two trapezoids sharing the edge according to the output format for a trapezoid given earlier.
If the point is in the interior of a trapezoid, then output the trapezoid in the given format.
Testing the incidence of a point on an edge or the coincidence of two points comes down to checking whether certain expression is equal to zero. Due to floating arithmetics, a number is considered to be "zero" if it is less than some very small constant epsilon. You may set its value to, say, 0.000001, although the actual value also depends on how you set up the expression, e.g., normalizing a vector or not.
During the user interaction, the constructed trapezoidal map for every input planar subdivision is stored in a separate file named by yourself. Below is a sample execution scenario, during which a lower case x ends a query or the entire execution.

Point Location Using Trapezoidal Maps

Trial 1:
Name of the input planar subdivision file: subdivision1.txt
Trapezoidal map constructed in the file trapezpoidalMap1.txt

Query point: (1, 1)
Trapezoid containing the point (1, 1):
...

Query point: (0, 0)
Vertex of the input subdivision:
v1 (0, 0) e1,2

Query point: (0.5,0.5)
On an edge of the input subdivision:
e2,3 v2 e3,2 f1 e3,1 e1,2

Query point: (4, 3)
Trapezoid containing the point (4, 3):
...

Query point: x
End of all queries in this map.


Trial 2:
Name of the input planar subdivision file: subdivision2.txt
Trapezoidal map constructed in the file trapezoidalMap2.txt

Query point: (-3, 10)
Trapezoid containing the point (-3, 10):
...

Query point: x
End of all queries in this map.


Trial 3:
Name of the input planar subdivision file: x


End of execution


Your code should print out the same text messages for user interactions.

Graphics (for bonus points)
You may receive up to 30 bonus points for graphical display of the constructed trapezoidal map alone, or together with the search structure DAG.